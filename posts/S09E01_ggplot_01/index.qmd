---
title: "Introduction to `ggplot`"
subtitle: "Code structure, data, aesthetic mappings, and geoms"
author:
  - "Jessica Cooperstone"
date: "2025-01-14"
categories: [ggplot, dataviz, plotting, tidyverse]
title-block-banner: false
image: img/ggplot2_masterpiece.png
alttext: "A fuzzy monster in a beret and scarf, critiquing their own column graph on a canvas in front of them while other assistant monsters (also in berets) carry over boxes full of elements that can be used to customize a graph (like themes and geometric shapes). In the background is a wall with framed data visualizations. Stylized text reads “ggplot2: build a data masterpiece. Art by Allison Horst"
---

# Introduction

```{r, fig.alt = "A fuzzy monster in a beret and scarf, critiquing their own column graph on a canvas in front of them while other assistant monsters (also in berets) carry over boxes full of elements that can be used to customize a graph (like themes and geometric shapes). In the background is a wall with framed data visualizations. Stylized text reads “ggplot2: build a data masterpiece.", fig.cap= "Figure from [Allison Horst](https://github.com/allisonhorst/stats-illustrations)", out.width = "70%", fig.align = "center", echo = FALSE}
knitr::include_graphics("img/ggplot2_masterpiece.png")
```

The very popular R package [`ggplot2`](https://ggplot2.tidyverse.org/index.html) is based on a system called the [Grammar of Graphics](https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448/ref=as_li_ss_tl) by Leland Wilkinson which aims to create a grammatical rules for the development of graphics. It is part of a larger group of packages called "the tidyverse."

## What is the tidyverse?

The package `ggplot2` is a part of a larger collection of packages called ["the tidyverse"](https://www.tidyverse.org/) that are designed for data science. You can certainly use R without using the tidyverse, but it has many packages that I think will make your life a lot easier. 
We can install just `ggplot2` or install all of the packages in the core tidyverse (which is what I'd recommend since we will use the others too), which include:

- [`dplyr`](https://dplyr.tidyverse.org/): for data manipulation
- [`ggplot2`](https://ggplot2.tidyverse.org/): a "grammar of graphics" for creating beautiful plots
- [`readr`](https://readr.tidyverse.org/): for reading in rectangular data (i.e., Excel-style formatting)
- [`tibble`](https://tibble.tidyverse.org/): using tibbles as modern/better dataframes
- [`stringr`](https://stringr.tidyverse.org/): handling strings (i.e., text or stuff in quotes)
- [`forcats`](https://forcats.tidyverse.org/): for handling categorical variables (i.e., factors) (meow!)
- [`tidyr`](https://tidyr.tidyverse.org/): to make "tidy data"
- [`purrr`](https://purrr.tidyverse.org/): for enhancing functional programming (also meow!)
- [`lubridate`](https://lubridate.tidyverse.org/): for working with dates

We have used many of these other packages in Code Club. There are more tidyverse packages outside of these core nine, and we will talk about some of them another time.

> **tl;dr** Tidyverse has a lot of packages that make data analysis easier.  None of them are required, but I think you'll find many tidyverse approaches  easier and more intuitive than using base R.  

You can find [here](https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html) some examples of comparing tidyverse and base R syntax.

## Installing ggplot & tidyverse 

To install packages in R that are on the [Comprehensive R Archive Network (CRAN)](https://cran.r-project.org/), you can use the function `install.packages()`.

```{r install, eval = FALSE}
install.packages("tidyverse")
install.packages("ggplot2")
```

We only need to install packages once. But, every time we want to use them, we need to "load" them, and can do this using the function `library()`. Since you will likely often use the `tidyverse` functions, it's a good habit to add the code `library(tidyverse)` to the top of each of your scripts/RMarkdown/Quarto documents.

```{r}
library(tidyverse)
```

# What is "ggplot?"

The "gg" in ggplot stands for "grammar of graphics" and all plots share a common template. This is fundamentally different than plotting using a program like Excel, where you first pick your plot type, and then you add your data. With ggplot, you start with data, add a coordinate system, and then add "geoms," which indicate what type of plot you want. A cool thing about ggplot is that you can add and layer different geoms together, to create a fully customized plot that is exactly what you want. If this sounds nebulous right now, that's okay, we are going to talk more about this.


```{r data exploration, fig.alt = "A group of fuzzy round monsters with binoculars, backpacks and guide books looking up a graphs flying around with wings (like birders, but with exploratory data visualizations). Stylized text reads “ggplot2: visual data exploration.”", fig.cap= "Figure from [Allison Horst](https://github.com/allisonhorst/stats-illustrations)", out.width = "70%", fig.align = "center", echo = FALSE}
knitr::include_graphics("img/ggplot2_exploratory.png")
```

# What can you do with ggplot?

Let's start by looking at the different types of plots that can be made using `ggplot2`. We will do this by looking at the [`ggplot2` cheatsheet](https://rstudio.github.io/cheatsheets/data-visualization.pdf).

# A plotting framework
```{r layers, fig.alt = "A pictorial depiction of the different ggplot layers, starting with data, aesthetics, geometries, scales, facets, coordinates, labels, and themes", fig.cap= "Figure from [Andrew Heiss](https://datavizs21.classes.andrewheiss.com/)", out.width = "70%", fig.align = "center", echo = FALSE}
knitr::include_graphics("img/plotting_framework.png")
```

You can think about a ggplot as being composed of layers. You start with your data, and continue to add layers until you get the plot that you want. This might sound a bit abstract so I am going to talk through this with an example.

First, let's load some practice data. We are going to use a fun 🐧 data set from the package
[`palmerpenguins`](https://allisonhorst.github.io/palmerpenguins/). If you don't already have this, you can download it with the code below:

```{r, eval = FALSE}
install.packages("palmerpenguins")
```

Then we can load the data.
```{r}
library(palmerpenguins)
```

The dataset itself is called `penguins`. Let's look at it using the function `glimpse()`.

```{r}
glimpse(penguins)
```

Let's start by trying to make a simple scatterplot, where we see the relationship between `bill_length_mm` and `bill_depth_mm`.

## Data
The first argument passed to your plot is the data. How did I know that? It's in the documentation.
```{r ggplot help}
?ggplot()
```

The simplest ggplot code you can write, just using the `ggplot()` function and indicating the data we want to use. Because data is the default first argument, you can actually omit the `data =` part of this code and it will work just the same.
```{r data only}
ggplot(data = penguins)
```

Why do we not see a plot? Well we haven't told R what to plot! We are getting the first "base" layer of the plot.

You can also pipe `|>` or `%>%`, the data to the ggplot function. When reading code, you can interpret the pipe as "and then." Here, take the `garden_harvest_tomato` data, and then, run `ggplot()`. Writing code in this way is my preference so I tend to code like this. We talked in more detail about the pipe last week, so you can go back [there](https://datavisualizing.netlify.app/2_04_wrangling/04_wrangling#The_pipe_|) and read more if you like.
```{r data and pipe}
penguins |> 
  ggplot()
```

Still nothing. Well that's what we would expect.

## Aesthetic mappings `aes()`
Now that we've indicated our data, we can add aesthetics mapping so we can work towards actually see a plot. We want to make a scatterplot where on the x-axis we have bill length (`bill_length_mm`), and on the y-axis we have bill depth (`bill_depth_mm`).
```{r aes}
penguins |> 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm))
```

So we have progressed from a blank plot, but we still do not have a plot by basically anyone's defintion. Why not?

Even though we have indicated to R our data and aesthetic mappings, we have not indicated what precisely to do with our data. We have said what we want on x and y (and now we can see those labelled appearing) but we have not indicated what *type* of plot we want. And, we can do that in the next step, by adding a `geom_`.

## Geoms `geom_`

Now let's indicate what type of plot we want. In this example, we are going to make a scatterplot, and to do that we will use [`geom_point()`](https://ggplot2.tidyverse.org/reference/geom_point.html)
```{r geom point}
penguins |> 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()
```

We have a plot! It's not a really good plot, but its a plot and we can work from here.

# Practice