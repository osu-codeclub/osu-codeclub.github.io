{
  "hash": "4570b1ce11857c41a8dc1371b355066e",
  "result": {
    "markdown": "---\ntitle: \"Plotting 3: histogram, density, and bar plots\"\nauthor:\n  - \"Horacio Lopez-Nicora\"\ndate: \"2024-04-12\"\ncategories: [plotting, ggplot2]\ntitle-block-banner: false\nnumber-depth: 3\nimage: img/ggplot2_exploratory.png\nknitr:\n  opts_chunk:\n    out.width: \"85%\"\n    class-output: styled-output\n    fig.align: 'center'\neditor: source\neditor_options: \n  chunk_output_type: console\n---\n\n\n## Introduction\n\n#### Recap of the past session\n\nIn last week's session, we delved into aesthetics and gained a deeper understanding of the topic. Additionally, we introduced the theme() function. We also acquired knowledge on the fundamentals of geom_boxplot(), geom_violin(), and stat_summary.\n\n#### Session Goals\n\n-   Let's explore our **palmerpinguins** dataset using histogram and density plots. We will learn about **geom_histogram()** and **geom_density()**.\n-   Learn the basic of **bar graph** in `ggplot2`.\n\n<br>\n\n## Our data set\n\n![Artwork by [Allison Horst](https://twitter.com/allison_horst).](img/dashboard.jpeg){fig-align=\"center\" width=\"80%\"}\n\n<br>\n\nWe are going to continue using our üêß data set from the package [`palmerpenguins`](https://allisonhorst.github.io/palmerpenguins/). If you haven't done so, please install that package first:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstall.packages(\"palmerpenguins\")\n```\n:::\n\n\n[`palmerpenguins`](https://allisonhorst.github.io/palmerpenguins/index.html) is a package developed by Allison Horst, Alison Hill and Kristen Gorman, including a data set collected by Dr. Kristen Gorman at the Palmer Station Antarctica, as part of the Long Term Ecological Research Network. It is a nice, relatively simple data set to practice data exploration and visualization in R.\n\nWe'll now load the package, along with the tidyverse (which includes ggplot2):\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n‚îÄ‚îÄ Attaching core tidyverse packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 2.0.0 ‚îÄ‚îÄ\n‚úî dplyr     1.1.3     ‚úî readr     2.1.4\n‚úî forcats   1.0.0     ‚úî stringr   1.5.0\n‚úî ggplot2   3.4.4     ‚úî tibble    3.2.1\n‚úî lubridate 1.9.3     ‚úî tidyr     1.3.0\n‚úî purrr     1.0.2     \n‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ\n‚úñ dplyr::filter() masks stats::filter()\n‚úñ dplyr::lag()    masks stats::lag()\n‚Ñπ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n:::\n\n\nOnce you've loaded that package you will have a data frame called `penguins` at your disposal --- let's take a look:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Or glimpse() for a sort of transposed view, so we can see all columns:\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.styled-output}\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel‚Ä¶\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse‚Ä¶\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, ‚Ä¶\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, ‚Ä¶\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186‚Ä¶\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, ‚Ä¶\n$ sex               <fct> male, female, female, NA, female, male, female, male‚Ä¶\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007‚Ä¶\n```\n:::\n:::\n\n\n<br>\n\n## Histograms: `geom_histogram()`\n\nA histogram provides a precise graphical portrayal of the distribution of numerical data. It only needs one aesthetic, which is the `x` variable.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = flipper_length_mm)) + \n  geom_histogram() + \n  labs(title = \"Histogram of penguin flipper length\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n::: callout-warning\n#### It is crucial to have good [labels](https://ggplot2.tidyverse.org/reference/labs.html) to ensure the accessibility of your plots to a broader audience. Always make sure that the axis (within `labs()`, use `x=\"x-title\"`, `y=\"y-title\"`) and legend (within `labs()`, use `fill/color=\"legend-title\"`) labels display the complete variable name.\n:::\n\nThe default computation of `geom_histogram` through `stat_bin` uses 30 bins, which is not always an optimal choice.\n\nThere are possible options to address this issue. One option is to set the number of bins using the `bins` argument. Another option is to adjust the width of each bin using the `binwidth` argument.\n\nThe number of bins or bars in the histogram can be customized using the `bins` argument in the `geom_histogram` function.\n\nAn alternative option involves utilizing the `binwidth` argument in the `geom_histogram` function, which dictates the width of each bin on the X-axis. *It is important to note that this argument takes priority over the bin argument*.\n\n<br>\n\n::: exercise\n#### {{< fa user-edit >}} Exercise 1\n\n-   Using the example from above, within `geom_histogram()` use the `bins` and `binwidth` arguments to change the size of each bar/bin.\n\n<details>\n\n<summary>Hints (click here)</summary>\n\nYou can use the following argument `geom_histogram(bins = TRY DIFFERENT VALUES)` or `geom_histogram(binwidth = TRY DIFFERENT VALUES)`.\n\n</details>\n\n<details>\n\n<summary>Solutions (click here)</summary>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = flipper_length_mm)) + \n  geom_histogram(binwidth = 2) + \n  labs(title = \"Histogram of penguin flipper length\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\nggplot(penguins, aes(x = flipper_length_mm)) + \n  geom_histogram(bins = 13) + \n  labs(title = \"Histogram of penguin flipper length\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){fig-align='center' width=85%}\n:::\n:::\n\n\n</details>\n:::\n\n<br>\n\n### Is the distribution bimodal?\n\nHistograms are effective in displaying the distributional characteristics of variables within a dataset. They provide visual cues regarding the location of distribution peaks, whether the distribution is skewed or symmetric, and the presence of any outliers. **However, given that our dataset consists of three distinct species, can we utilize histograms to analyze all of them simultaneously?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins) + \n  aes(x = flipper_length_mm, color = species) + \n  geom_histogram(bins = 30) + \n  theme_bw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Histogram of penguin flipper length\", \n       subtitle = \"By species\", \n       color = \"Penguin species\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n::: callout-warning\n#### [Themes](https://ggplot2.tidyverse.org/reference/theme.html) are a powerful way for customizing the non-data elements of your plots, such as titles, labels, fonts, background, gridlines, and legends. They can be employed to provide plots with a consistently customized appearance.\n:::\n\n<br>\n\n::: exercise\n#### {{< fa user-edit >}} Exercise 2\n\n-   Instead of coloring only the outline of the `bins`, let's color the `bins` themselves.\n\n<details>\n\n<summary>Hints (click here)</summary>\n\nYou will have to use the argument `fill`. Please be sure that your legend title, adjusted using `labs()`, has been properly set.\n\n</details>\n\n<details>\n\n<summary>Solutions (click here)</summary>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins) + \n  aes(x = flipper_length_mm, fill = species) + \n  geom_histogram(bins = 30) + \n  theme_bw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Histogram of penguin flipper length\", \n       subtitle = \"By species\",\n       fill = \"Penguin species\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n</details>\n:::\n\n<br>\n\n## Density plot: `geom_density()`\n\nA density plot provides an alternative way to visualize the distributions of numerical variables. It is essentially a smoothed version of a histogram and serves as a practical option, especially when dealing with continuous data originating from a smooth underlying distribution.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins) + \n  aes(x = flipper_length_mm, color = species) + \n  geom_density() + \n  theme_bw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Density plot of penguin flipper length\", \n       subtitle = \"By species\",\n       color = \"Penguin species\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n<br>\n\n::: exercise\n#### {{< fa user-edit >}} Exercise 3\n\nLet's analyze the distribution of penguins' body mass according to their species utilizing density plots. - Incorporate distinct colors for each species in the density plots, not just the lines. Employ a level of transparency to provide a clearer view. Please ensure that the density plot is accompanied by a title, subtitle, and **caption**.\n\n<details>\n\n<summary>Hints (click here)</summary>\n\nYou will have to use the argument `fill` to incorporate color, `alpha` for transparency, and `caption` within the `labs` argument.\n\n</details>\n\n<details>\n\n<summary>Solutions (click here)</summary>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins) + \n  aes(x = body_mass_g, fill = species) + \n  geom_density(alpha = 0.2) + \n  theme_bw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Density plot of penguin body mass\", \n       subtitle = \"By species\",\n       caption = \"PalmerPinguins Dataset\",\n       fill = \"Penguin species\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n</details>\n:::\n\n<br>\n\n## Geoms from ggplot ‚Äúextension‚Äù packages\n\nTransparency can help when density plots ovelap, but can I do better?\n\nThere are various [**ggplot extension packages**](https://exts.ggplot2.tidyverse.org/gallery/) available. Some of these packages provide extra geoms, such as the trendy \"ridgeline\" plots offered by the ggridges package.\n\n\nTransparency can help when density plots ovelap, but can I do better?\n\nThere are various [**ggplot extension packages**](https://exts.ggplot2.tidyverse.org/gallery/) available. Some of these packages provide extra geoms, such as the trendy \"ridgeline\" plots offered by the ggridges package.\n\nWe‚Äôll have to install the package:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstall.packages(\"ggridges\")\n```\n:::\n\n\nAfter loading it, we can utilize the ridgeplot geom `geom_density_ridges()` in the same manner as any other geom.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggridges)\nggplot(penguins) + \n  aes(x = body_mass_g, y = species, fill = species) + \n  geom_density_ridges(alpha = 0.2) + \n  theme_bw() + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Density plot of penguin body mass\", \n       subtitle = \"By species\",\n       caption = \"PalmerPinguins Dataset\",\n       fill = \"Penguin species\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nPicking joint bandwidth of 153\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n::: callout-warning\n#### Please note that when using `geom_density_ridges()`, we need to specify the `y`.\n:::\n\n## Bar graphs: `geom_bar()`\n\nIn order to analyze the distribution of a categorical variable, a bar chart can be employed. The bar heights indicate the frequency of observations associated with each `x` value.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = species)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n### Stacked bar plots.\n\nStacked bar plots can be utilized to visualize the association between two categorical variables. For instance, these two stacked bar plots demonstrate the relation between island and species, showcasing the distribution of species within each island.\n\nStacked bar plots can be utilized to visualize the association between two categorical variables. For instance, these two stacked bar plots demonstrate the relation between island and species, showcasing the distribution of species within each island.\n\nThe first plot displays the frequencies of penguin species on different islands. It reveals that there is an equal number of Adelies on each island. Nonetheless, we lack a clear understanding of the percentage distribution within each specific island.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\nThe second plot, which is a relative frequency plot created by setting `position = \"fill\"` in the **geom**, is more useful for comparing species distributions across islands because it is not influenced by the unequal numbers of penguins on the islands. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = island, fill = species)) +\n  geom_bar(position = \"fill\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\nBy using this plot, we can see that Gentoo penguins exclusively live on Biscoe Island and represent approximately 75% of the penguins on that island. Chinstrap penguins exclusively inhabit Dream Island and make up approximately 50% of the penguins on that island. Whereas Adelie penguins inhabit all three islands and account for the entire penguin population on Torgersen Island.\n\n\n## Bar chart of means: `stat_summary()`\n\nTo summarize the data using averages, we can use the `stat_summary()` function. Instead of invoking a geom_* function, we can employ `stat_summary()` to define the desired method for summarizing the data and presenting it in our visual representation.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = species, y = body_mass_g)) +\n  theme_bw() +\n  stat_summary(fun = \"mean\",\n               geom = \"bar\",\n               alpha = 0.5,\n               color = \"black\",\n               size = 0.5,\n               mapping = aes(fill = species)) +\n  stat_summary(fun.data = \"mean_se\",\n               geom = \"errorbar\",\n               width = 0.5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n::: exercise\n#### {{< fa user-edit >}} Exercise 4\n\n1. To keep only the Gentoo data, pipe your dataset into the `filter()` function.\n2. Create a bar graph examining the mean bill_length_mm by sex by piping the filtered data into `ggplot()`.\n3. Ensure that the points with unknown sex (NA) are removed.\n4. Include error bars in the bar plots and add transparency.\n6. Display all data points on top of the boxplot.\n7. Finally, use color to fill every bar by using the \"DarSet2\" palette from the \"RColorBrewer\" package, which was installed last week.\n\n<details>\n\n<summary>Hints (click here)</summary>\n\nYou will have to load `RColorBrewer` and use the argument `scale_fill_brewer(palette = \"Dark2\")`.\n\n</details>\n\n<details>\n\n<summary>Solutions (click here)</summary>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  filter(species == \"Gentoo\", !is.na(sex)) |> \n  ggplot(aes(x = sex, y = bill_length_mm)) + \n  theme_bw() +\n  stat_summary(geom = \"bar\",\n               fun = \"mean\",\n               alpha = 0.5,\n               color = \"black\",\n               size = 0.5,\n               mapping = aes(fill=sex)) +\n    stat_summary(fun.data = \"mean_se\", \n                 geom = \"errorbar\", \n                 width = 0.5) +\n  scale_fill_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\n</details>\n:::\n\n<br>\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}